<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>mssql-change-tracking</title>
	<meta name="description" content="Documentation for mssql-change-tracking">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">mssql-change-tracking</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>mssql-change-tracking</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#ms-sql-server-change-tracking-functions" id="ms-sql-server-change-tracking-functions" style="color: inherit; text-decoration: none;">
					<h1>MS SQL server change tracking functions</h1>
				</a>
				<p>This node.js module written in Typescript and uses <a href="https://www.npmjs.com/package/mssql">mssql</a> under the hood to run the sql commands and provide high level functions to manage and work with MS SQL Change Tracking.</p>
				<a href="#docs" id="docs" style="color: inherit; text-decoration: none;">
					<h2>Docs</h2>
				</a>
				<ul>
					<li>Module docs <a href="https://saostad.github.io/mssql-change-tracking/">here</a></li>
					<li>Microsoft docs <a href="https://docs.microsoft.com/en-us/sql/relational-databases/track-changes/work-with-change-tracking-sql-server?view=sql-server-ver15">here</a></li>
				</ul>
				<a href="#how-to-use" id="how-to-use" style="color: inherit; text-decoration: none;">
					<h2>How to use</h2>
				</a>
				<p><code>npm i mssql mssql-change-tracking</code></p>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">ctDbStatus</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;mssql-change-tracking&quot;</span><span style="color: #000000">;</span>
<span style="color: #AF00DB">import</span><span style="color: #000000"> </span><span style="color: #001080">sql</span><span style="color: #000000"> </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;mssql&quot;</span><span style="color: #000000">;</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">pool</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #001080">sql</span><span style="color: #000000">.</span><span style="color: #795E26">ConnectionPool</span><span style="color: #000000">({</span>
<span style="color: #000000">  </span><span style="color: #001080">server:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;xxxx&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">user:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;xxxx&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">password:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;xxxx&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">database:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;MY_DB_NAME&quot;</span><span style="color: #000000">,</span>
<span style="color: #000000">});</span>

<span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">pool</span><span style="color: #000000">.</span><span style="color: #795E26">connect</span><span style="color: #000000">();</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">status</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">ctDbStatus</span><span style="color: #000000">({ </span><span style="color: #001080">dbName:</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;MY_DB_NAME&quot;</span><span style="color: #000000">, </span><span style="color: #001080">pool</span><span style="color: #000000"> });</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #001080">status</span><span style="color: #000000">);</span>
</code></pre>
				<a href="#note-to-begin" id="note-to-begin" style="color: inherit; text-decoration: none;">
					<h2>Note to begin</h2>
				</a>
				<p>Before an application can obtain changes for the first time, the application must send a query to obtain the initial data and the synchronization version. The application must obtain the appropriate data directly from the table, and then use CHANGE_TRACKING_CURRENT_VERSION() to obtain the initial version. This version will be passed to CHANGETABLE(CHANGES ...) the first time that changes are obtained.</p>
				<a href="#obtaining-consistent-and-correct-results-reference" id="obtaining-consistent-and-correct-results-reference" style="color: inherit; text-decoration: none;">
					<h2>Obtaining Consistent and Correct Results (<a href="https://docs.microsoft.com/en-us/sql/relational-databases/track-changes/work-with-change-tracking-sql-server?view=sql-server-ver15#obtaining-consistent-and-correct-results">reference</a>)</h2>
				</a>
				<p>Obtaining the changed data for a table requires multiple steps. Be aware that inconsistent or incorrect results could be returned if certain issues are not considered and handled.</p>
				<p>For example, to obtain the changes that were made to a Sales table and SalesOrders table, an application would perform the following steps:</p>
				<p>Validate the last synchronized version by using CHANGE_TRACKING_MIN_VALID_VERSION().</p>
				<p>Obtain the version that can be used to obtain change the next time by using CHANGE_TRACKING_CURRENT_VERSION().</p>
				<p>Obtain the changes for the Sales table by using CHANGETABLE(CHANGES ...).</p>
				<p>Obtain the changes for the SalesOrders table by using CHANGETABLE(CHANGES ...).</p>
				<p>Two processes are occurring in the database that can affect the results that are returned by the previous steps:</p>
				<p>The cleanup process runs in the background and removes change tracking information that is older than the specified retention period.</p>
				<p>The cleanup process is a separate background process that uses the retention period that is specified when you configure change tracking for the database. The issue is that the cleanup process can occur in the time between when the last synchronization version was validated and when the call to CHANGETABLE(CHANGES...) is made. A last synchronization version that was just valid might no longer be valid by the time the changes are obtained. Therefore, incorrect results might be returned.</p>
				<p>Ongoing DML operations are occurring in the Sales and SalesOrders tables, such as the following operations:</p>
				<p>Changes can be made to the tables after the version for next time has been obtained by using CHANGE_TRACKING_CURRENT_VERSION(). Therefore, more changes can be returned than expected.</p>
				<p>A transaction could commit in the time between the call to obtain changes from the Sales table and the call to obtain changes from the SalesOrders table. Therefore, the results for the SalesOrder table could have foreign key value that does not exist in the Sales table.</p>
				<p>To overcome the previously listed challenges, we recommend that you use snapshot isolation. This will help to ensure consistency of change information and avoid race conditions that are related to the background cleanup task. If you do not use snapshot transactions, developing an application that uses change tracking could require significantly more effort.</p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Exports</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-function">
						<a href="modules.html#ctaccessgrant" class="tsd-kind-icon">ct<wbr>Access<wbr>Grant</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#ctaccessstatus" class="tsd-kind-icon">ct<wbr>Access<wbr>Status</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="modules.html#ctchanges" class="tsd-kind-icon">ct<wbr>Changes</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="modules.html#ctchangesallfields" class="tsd-kind-icon">ct<wbr>Changes<wbr>All<wbr>Fields</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#ctcurrentversion" class="tsd-kind-icon">ct<wbr>Current<wbr>Version</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#ctdbdisable" class="tsd-kind-icon">ct<wbr>DbDisable</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#ctdbenable" class="tsd-kind-icon">ct<wbr>DbEnable</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#ctdbstatus" class="tsd-kind-icon">ct<wbr>DbStatus</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#ctisversionvalid" class="tsd-kind-icon">ct<wbr>IsVersion<wbr>Valid</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#ctisversionvalidalltables" class="tsd-kind-icon">ct<wbr>IsVersion<wbr>Valid<wbr>All<wbr>Tables</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#ctminvalidversion" class="tsd-kind-icon">ct<wbr>Min<wbr>Valid<wbr>Version</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#cttabledisable" class="tsd-kind-icon">ct<wbr>Table<wbr>Disable</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#cttableenable" class="tsd-kind-icon">ct<wbr>Table<wbr>Enable</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#cttablesstatus" class="tsd-kind-icon">ct<wbr>Tables<wbr>Status</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="modules.html#getprimarykeys" class="tsd-kind-icon">get<wbr>Primary<wbr>Keys</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>